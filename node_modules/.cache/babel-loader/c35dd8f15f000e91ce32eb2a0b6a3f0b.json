{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport { createScopedElement } from \"../../lib/jsxRuntime\";\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nimport { PureComponent } from 'react';\nimport { classNames } from \"../../lib/classNames\";\nimport FormField from \"../FormField/FormField\";\nimport { setRef } from \"../../lib/utils\";\nimport { withAdaptivity } from \"../../hoc/withAdaptivity\";\nimport { getClassName } from \"../..\";\nimport { withPlatform } from \"../../hoc/withPlatform\";\n\nvar Textarea = /*#__PURE__*/function (_PureComponent) {\n  _inherits(Textarea, _PureComponent);\n\n  var _super = _createSuper(Textarea);\n\n  function Textarea(props) {\n    var _this;\n\n    _classCallCheck(this, Textarea);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"isControlledOutside\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"element\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"getRef\", function (element) {\n      _this.element = element;\n      setRef(element, _this.props.getRef);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"resize\", function () {\n      var el = _this.element;\n\n      if (el) {\n        var offsetHeight = el.offsetHeight,\n            scrollHeight = el.scrollHeight;\n        var style = window.getComputedStyle(el);\n        var paddingTop = parseInt(style.paddingTop);\n        var paddingBottom = parseInt(style.paddingBottom);\n        var diff = paddingTop + paddingBottom;\n\n        if (scrollHeight + diff <= offsetHeight) {\n          diff = 0;\n        }\n\n        if (el.value) {\n          _this.setState({\n            height: scrollHeight - diff\n          });\n        }\n\n        _this.setState({\n          height: 0\n        }, function () {\n          var height = el.scrollHeight - diff;\n\n          _this.setState({\n            height: height\n          });\n\n          if (_this.props.onResize) {\n            _this.props.onResize(el);\n          }\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"onChange\", function (e) {\n      if (!_this.isControlledOutside) {\n        _this.setState({\n          value: e.target.value\n        });\n      }\n\n      if (_this.props.onChange) {\n        _this.props.onChange(e);\n      }\n    });\n\n    if (typeof props.value !== 'undefined') {\n      _this.isControlledOutside = true;\n      _this.state = {};\n    } else {\n      _this.state = {\n        value: props.defaultValue || ''\n      };\n    }\n\n    return _this;\n  }\n\n  _createClass(Textarea, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      if (this.props.grow) {\n        this.resize();\n      }\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState) {\n      var _this2 = this;\n\n      if (prevProps.value && this.props.value === '') {\n        // Fix iOS extra indent on removing content\n        window.requestAnimationFrame(function () {\n          _this2.element.value = '';\n        });\n      }\n\n      if (this.props.grow && (this.isControlledOutside && prevProps.value !== this.props.value || !this.isControlledOutside && prevState.value !== this.state.value)) {\n        this.resize();\n      }\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this$props = this.props,\n          defaultValue = _this$props.defaultValue,\n          value = _this$props.value,\n          onChange = _this$props.onChange,\n          grow = _this$props.grow,\n          style = _this$props.style,\n          onResize = _this$props.onResize,\n          className = _this$props.className,\n          getRootRef = _this$props.getRootRef,\n          getRef = _this$props.getRef,\n          sizeY = _this$props.sizeY,\n          platform = _this$props.platform,\n          restProps = _objectWithoutProperties(_this$props, [\"defaultValue\", \"value\", \"onChange\", \"grow\", \"style\", \"onResize\", \"className\", \"getRootRef\", \"getRef\", \"sizeY\", \"platform\"]);\n\n      var height = this.state.height || style.height || 66;\n      return createScopedElement(FormField, {\n        vkuiClass: classNames(getClassName('Textarea', platform), \"Textarea--sizeY-\".concat(sizeY)),\n        className: className,\n        style: style,\n        getRootRef: getRootRef,\n        disabled: restProps.disabled\n      }, createScopedElement(\"textarea\", _extends({}, restProps, {\n        vkuiClass: \"Textarea__el\",\n        value: this.value,\n        onChange: this.onChange,\n        ref: this.getRef,\n        style: {\n          height: height\n        }\n      })));\n    }\n  }, {\n    key: \"value\",\n    get: function get() {\n      return this.isControlledOutside ? this.props.value : this.state.value;\n    }\n  }]);\n\n  return Textarea;\n}(PureComponent);\n\n_defineProperty(Textarea, \"defaultProps\", {\n  style: {},\n  defaultValue: '',\n  grow: true\n});\n\nexport default withPlatform(withAdaptivity(Textarea, {\n  sizeY: true\n}));","map":{"version":3,"sources":["../../../src/components/Textarea/Textarea.tsx"],"names":["Textarea","PureComponent","props","value","style","defaultValue","grow","setRef","el","offsetHeight","scrollHeight","window","paddingTop","parseInt","paddingBottom","diff","height","e","prevProps","prevState","onChange","onResize","className","getRootRef","getRef","sizeY","platform","restProps","classNames","getClassName","disabled","withPlatform","withAdaptivity"],"mappings":"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","sourcesContent":["import { ChangeEvent, ChangeEventHandler, PureComponent, TextareaHTMLAttributes, RefCallback } from 'react';\nimport { classNames } from '../../lib/classNames';\nimport FormField from '../FormField/FormField';\nimport { HasRef, HasRootRef } from '../../types';\nimport { setRef } from '../../lib/utils';\nimport { withAdaptivity, AdaptivityProps } from '../../hoc/withAdaptivity';\nimport { getClassName, HasPlatform } from '../..';\nimport { withPlatform } from '../../hoc/withPlatform';\n\nexport interface TextareaProps extends\n  TextareaHTMLAttributes<HTMLTextAreaElement>,\n  HasRef<HTMLTextAreaElement>,\n  HasRootRef<HTMLElement>,\n  AdaptivityProps,\n  HasPlatform {\n  grow?: boolean;\n  onResize?(el: HTMLTextAreaElement): void;\n  defaultValue?: string;\n}\n\nexport interface TextareaState {\n  value?: string;\n  height?: number;\n}\n\nclass Textarea extends PureComponent<TextareaProps, TextareaState> {\n  constructor(props: TextareaProps) {\n    super(props);\n\n    if (typeof props.value !== 'undefined') {\n      this.isControlledOutside = true;\n      this.state = {};\n    } else {\n      this.state = {\n        value: props.defaultValue || '',\n      };\n    }\n  }\n\n  isControlledOutside?: boolean;\n  element: HTMLTextAreaElement;\n\n  componentDidMount() {\n    if (this.props.grow) {\n      this.resize();\n    }\n  }\n\n  static defaultProps: TextareaProps = {\n    style: {},\n    defaultValue: '',\n    grow: true,\n  };\n\n  getRef: RefCallback<HTMLTextAreaElement> = (element) => {\n    this.element = element;\n    setRef(element, this.props.getRef);\n  };\n\n  resize: VoidFunction = () => {\n    const el = this.element;\n\n    if (el) {\n      const { offsetHeight, scrollHeight } = el;\n      const style = window.getComputedStyle(el);\n      const paddingTop = parseInt(style.paddingTop);\n      const paddingBottom = parseInt(style.paddingBottom);\n\n      let diff = paddingTop + paddingBottom;\n\n      if (scrollHeight + diff <= offsetHeight) {\n        diff = 0;\n      }\n\n      if (el.value) {\n        this.setState({ height: scrollHeight - diff });\n      }\n\n      this.setState({ height: 0 }, () => {\n        const height = el.scrollHeight - diff;\n\n        this.setState({ height });\n\n        if (this.props.onResize) {\n          this.props.onResize(el);\n        }\n      });\n    }\n  };\n\n  get value() {return this.isControlledOutside ? this.props.value : this.state.value;}\n\n  onChange: ChangeEventHandler = (e: ChangeEvent<HTMLTextAreaElement>) => {\n    if (!this.isControlledOutside) {\n      this.setState({ value: e.target.value });\n    }\n\n    if (this.props.onChange) {\n      this.props.onChange(e);\n    }\n  };\n\n  componentDidUpdate(prevProps: TextareaProps, prevState: TextareaState) {\n    if (prevProps.value && this.props.value === '') {\n      // Fix iOS extra indent on removing content\n      window.requestAnimationFrame(() => {\n        this.element.value = '';\n      });\n    }\n\n    if (this.props.grow && (\n      this.isControlledOutside && prevProps.value !== this.props.value\n      || !this.isControlledOutside && prevState.value !== this.state.value\n    )) {\n      this.resize();\n    }\n  }\n\n  render() {\n    const { defaultValue, value, onChange, grow, style, onResize, className,\n      getRootRef, getRef, sizeY, platform, ...restProps } = this.props;\n\n    const height = this.state.height || style.height || 66;\n\n    return (\n      <FormField\n        vkuiClass={classNames(getClassName('Textarea', platform), `Textarea--sizeY-${sizeY}`)}\n        className={className}\n        style={style}\n        getRootRef={getRootRef}\n        disabled={restProps.disabled}\n      >\n        <textarea\n          {...restProps}\n          vkuiClass=\"Textarea__el\"\n          value={this.value}\n          onChange={this.onChange}\n          ref={this.getRef}\n          style={{ height }}\n        />\n      </FormField>\n    );\n  }\n}\nexport default withPlatform(withAdaptivity(Textarea, {\n  sizeY: true,\n}));\n"]},"metadata":{},"sourceType":"module"}