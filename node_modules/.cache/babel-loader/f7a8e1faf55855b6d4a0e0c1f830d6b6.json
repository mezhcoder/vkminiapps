{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _objectWithoutProperties from \"@babel/runtime/helpers/objectWithoutProperties\";\nimport { createScopedElement } from \"../../lib/jsxRuntime\";\nimport { useEffect, useMemo, useRef, useState } from 'react';\nimport { useDOM } from \"../../lib/dom\";\nimport { classNames } from \"../../lib/classNames\";\nimport { AppRootContext } from \"./AppRootContext\";\nimport { withAdaptivity, SizeType } from \"../../hoc/withAdaptivity\";\nimport { useIsomorphicLayoutEffect } from \"../../lib/useIsomorphicLayoutEffect\";\nimport { classScopingMode } from \"../../lib/classScopingMode\";\nimport { IconSettingsProvider } from '@vkontakte/icons';\nimport { elementScrollController, globalScrollController, ScrollContext } from \"./ScrollContext\"; // Используйте classList, но будьте осторожны\n\n/* eslint-disable no-restricted-properties */\n\nfunction applyAdaptivityStyles(container, sizeX) {\n  if (sizeX === SizeType.REGULAR) {\n    container.classList.add('vkui--sizeX-regular');\n  } else {\n    container.classList.remove('vkui--sizeX-regular');\n  }\n}\n\nvar AppRoot = function AppRoot(_ref) {\n  var children = _ref.children,\n      embedded = _ref.embedded,\n      sizeX = _ref.sizeX,\n      hasMouse = _ref.hasMouse,\n      _ref$noLegacyClasses = _ref.noLegacyClasses,\n      noLegacyClasses = _ref$noLegacyClasses === void 0 ? false : _ref$noLegacyClasses,\n      _ref$scroll = _ref.scroll,\n      scroll = _ref$scroll === void 0 ? 'global' : _ref$scroll,\n      props = _objectWithoutProperties(_ref, [\"children\", \"embedded\", \"sizeX\", \"hasMouse\", \"noLegacyClasses\", \"scroll\"]);\n\n  var rootRef = useRef();\n\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      portalRoot = _useState2[0],\n      setPortalRoot = _useState2[1];\n\n  var _useDOM = useDOM(),\n      window = _useDOM.window,\n      document = _useDOM.document;\n\n  var initialized = useRef(false);\n\n  if (!initialized.current) {\n    if (window && !embedded) {\n      document.documentElement.classList.add('vkui');\n    }\n\n    classScopingMode.noConflict = noLegacyClasses;\n  }\n\n  useEffect(function () {\n    if (scroll !== 'global' && !embedded) {\n      console.warn('[VKUI/AppRoot] Scroll modes only supported in embedded mode');\n    }\n  }, [scroll]); // one time initialization and cleanup\n\n  useIsomorphicLayoutEffect(function () {\n    var doc = document.documentElement;\n    var body = document.body;\n    var parentNode = rootRef.current.parentElement;\n    var portal;\n\n    if (embedded) {\n      portal = document.createElement('div');\n      portal.classList.add('vkui__portal-root');\n      body.appendChild(portal);\n      setPortalRoot(portal);\n      parentNode.classList.add('vkui__root', 'vkui__root--embedded');\n    } else {\n      parentNode.classList.add('vkui__root');\n    }\n\n    initialized.current = true;\n    return function () {\n      if (embedded) {\n        parentNode.classList.remove('vkui__root', 'vkui__root--embedded', 'vkui--sizeX-regular');\n        portal.parentElement.removeChild(portal);\n      } else {\n        parentNode.classList.remove('vkui__root');\n        body.classList.remove('vkui__root', 'vkui--sizeX-regular');\n        doc.classList.remove('vkui');\n      }\n    };\n  }, []); // adaptivity handler\n\n  useIsomorphicLayoutEffect(function () {\n    return applyAdaptivityStyles(embedded ? rootRef.current.parentElement : document.body, sizeX);\n  }, [sizeX]);\n  var scrollController = useMemo(function () {\n    return scroll === 'contain' ? elementScrollController(rootRef) : globalScrollController(window, document);\n  }, [scroll]);\n  return createScopedElement(\"div\", _extends({\n    ref: rootRef,\n    vkuiClass: classNames('AppRoot', {\n      'AppRoot--no-mouse': !hasMouse\n    })\n  }, props), createScopedElement(AppRootContext.Provider, {\n    value: {\n      appRoot: rootRef,\n      portalRoot: portalRoot,\n      embedded: embedded\n    }\n  }, createScopedElement(ScrollContext.Provider, {\n    value: scrollController\n  }, createScopedElement(IconSettingsProvider, {\n    classPrefix: \"vkui\",\n    globalClasses: !noLegacyClasses\n  }, children))));\n};\n\nexport default withAdaptivity(AppRoot, {\n  sizeX: true,\n  hasMouse: true\n});","map":{"version":3,"sources":["../../../src/components/AppRoot/AppRoot.tsx"],"names":["sizeX","SizeType","container","AppRoot","children","embedded","hasMouse","noLegacyClasses","scroll","props","rootRef","useRef","portalRoot","setPortalRoot","useState","window","document","useDOM","initialized","classScopingMode","useEffect","console","useIsomorphicLayoutEffect","doc","body","parentNode","portal","applyAdaptivityStyles","scrollController","useMemo","elementScrollController","globalScrollController","classNames","appRoot","withAdaptivity"],"mappings":"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","sourcesContent":["import { FC, HTMLAttributes, useEffect, useMemo, useRef, useState } from 'react';\nimport { useDOM } from '../../lib/dom';\nimport { classNames } from '../../lib/classNames';\nimport { AppRootContext } from './AppRootContext';\nimport { withAdaptivity, SizeType, AdaptivityProps } from '../../hoc/withAdaptivity';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { classScopingMode } from '../../lib/classScopingMode';\nimport { IconSettingsProvider } from '@vkontakte/icons';\nimport { elementScrollController, globalScrollController, ScrollContext, ScrollContextInterface } from './ScrollContext';\n\n// Используйте classList, но будьте осторожны\n/* eslint-disable no-restricted-properties */\n\nexport interface AppRootProps extends HTMLAttributes<HTMLDivElement>, AdaptivityProps {\n  embedded?: boolean;\n  window?: Window;\n  /** Убирает классы без префикса (.Button) */\n  noLegacyClasses?: boolean;\n  scroll?: 'global' | 'contain';\n}\n\nfunction applyAdaptivityStyles(container: HTMLElement, sizeX: SizeType) {\n  if (sizeX === SizeType.REGULAR) {\n    container.classList.add('vkui--sizeX-regular');\n  } else {\n    container.classList.remove('vkui--sizeX-regular');\n  }\n}\n\nconst AppRoot: FC<AppRootProps> = ({ children, embedded, sizeX, hasMouse, noLegacyClasses = false, scroll = 'global', ...props }) => {\n  const rootRef = useRef<HTMLDivElement>();\n  const [portalRoot, setPortalRoot] = useState<HTMLDivElement>(null);\n  const { window, document } = useDOM();\n\n  const initialized = useRef(false);\n\n  if (!initialized.current) {\n    if (window && !embedded) {\n      document.documentElement.classList.add('vkui');\n    }\n    classScopingMode.noConflict = noLegacyClasses;\n  }\n\n  useEffect(() => {\n    if (scroll !== 'global' && !embedded) {\n      console.warn('[VKUI/AppRoot] Scroll modes only supported in embedded mode');\n    }\n  }, [scroll]);\n\n  // one time initialization and cleanup\n  useIsomorphicLayoutEffect(() => {\n    const doc = document.documentElement;\n    const body = document.body;\n    const parentNode = rootRef.current.parentElement;\n\n    let portal: HTMLDivElement;\n    if (embedded) {\n      portal = document.createElement('div');\n      portal.classList.add('vkui__portal-root');\n      body.appendChild(portal);\n      setPortalRoot(portal);\n      parentNode.classList.add('vkui__root', 'vkui__root--embedded');\n    } else {\n      parentNode.classList.add('vkui__root');\n    }\n\n    initialized.current = true;\n\n    return () => {\n      if (embedded) {\n        parentNode.classList.remove('vkui__root', 'vkui__root--embedded', 'vkui--sizeX-regular');\n        portal.parentElement.removeChild(portal);\n      } else {\n        parentNode.classList.remove('vkui__root');\n        body.classList.remove('vkui__root', 'vkui--sizeX-regular');\n        doc.classList.remove('vkui');\n      }\n    };\n  }, []);\n\n  // adaptivity handler\n  useIsomorphicLayoutEffect(\n    () => applyAdaptivityStyles(embedded ? rootRef.current.parentElement : document.body, sizeX),\n    [sizeX],\n  );\n\n  const scrollController = useMemo<ScrollContextInterface>(\n    () => scroll === 'contain' ? elementScrollController(rootRef) : globalScrollController(window, document),\n    [scroll]);\n\n  return (\n    <div ref={rootRef} vkuiClass={classNames('AppRoot', {\n      'AppRoot--no-mouse': !hasMouse,\n    })} {...props}>\n      <AppRootContext.Provider value={{\n        appRoot: rootRef,\n        portalRoot: portalRoot,\n        embedded,\n      }}>\n        <ScrollContext.Provider value={scrollController}>\n          <IconSettingsProvider classPrefix=\"vkui\" globalClasses={!noLegacyClasses}>\n            {children}\n          </IconSettingsProvider>\n        </ScrollContext.Provider>\n      </AppRootContext.Provider>\n    </div>\n  );\n};\n\nexport default withAdaptivity(AppRoot, {\n  sizeX: true,\n  hasMouse: true,\n});\n"]},"metadata":{},"sourceType":"module"}