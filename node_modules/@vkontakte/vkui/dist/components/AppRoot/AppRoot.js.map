{"version":3,"sources":["../../../src/components/AppRoot/AppRoot.tsx"],"names":["useEffect","useMemo","useRef","useState","useDOM","classNames","AppRootContext","withAdaptivity","SizeType","useIsomorphicLayoutEffect","classScopingMode","IconSettingsProvider","elementScrollController","globalScrollController","ScrollContext","applyAdaptivityStyles","container","sizeX","REGULAR","classList","add","remove","AppRoot","children","embedded","hasMouse","noLegacyClasses","scroll","props","rootRef","portalRoot","setPortalRoot","window","document","initialized","current","documentElement","noConflict","console","warn","doc","body","parentNode","parentElement","portal","createElement","appendChild","removeChild","scrollController","appRoot"],"mappings":"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","sourcesContent":["import { FC, HTMLAttributes, useEffect, useMemo, useRef, useState } from 'react';\nimport { useDOM } from '../../lib/dom';\nimport { classNames } from '../../lib/classNames';\nimport { AppRootContext } from './AppRootContext';\nimport { withAdaptivity, SizeType, AdaptivityProps } from '../../hoc/withAdaptivity';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { classScopingMode } from '../../lib/classScopingMode';\nimport { IconSettingsProvider } from '@vkontakte/icons';\nimport { elementScrollController, globalScrollController, ScrollContext, ScrollContextInterface } from './ScrollContext';\n\n// Используйте classList, но будьте осторожны\n/* eslint-disable no-restricted-properties */\n\nexport interface AppRootProps extends HTMLAttributes<HTMLDivElement>, AdaptivityProps {\n  embedded?: boolean;\n  window?: Window;\n  /** Убирает классы без префикса (.Button) */\n  noLegacyClasses?: boolean;\n  scroll?: 'global' | 'contain';\n}\n\nfunction applyAdaptivityStyles(container: HTMLElement, sizeX: SizeType) {\n  if (sizeX === SizeType.REGULAR) {\n    container.classList.add('vkui--sizeX-regular');\n  } else {\n    container.classList.remove('vkui--sizeX-regular');\n  }\n}\n\nconst AppRoot: FC<AppRootProps> = ({ children, embedded, sizeX, hasMouse, noLegacyClasses = false, scroll = 'global', ...props }) => {\n  const rootRef = useRef<HTMLDivElement>();\n  const [portalRoot, setPortalRoot] = useState<HTMLDivElement>(null);\n  const { window, document } = useDOM();\n\n  const initialized = useRef(false);\n\n  if (!initialized.current) {\n    if (window && !embedded) {\n      document.documentElement.classList.add('vkui');\n    }\n    classScopingMode.noConflict = noLegacyClasses;\n  }\n\n  useEffect(() => {\n    if (scroll !== 'global' && !embedded) {\n      console.warn('[VKUI/AppRoot] Scroll modes only supported in embedded mode');\n    }\n  }, [scroll]);\n\n  // one time initialization and cleanup\n  useIsomorphicLayoutEffect(() => {\n    const doc = document.documentElement;\n    const body = document.body;\n    const parentNode = rootRef.current.parentElement;\n\n    let portal: HTMLDivElement;\n    if (embedded) {\n      portal = document.createElement('div');\n      portal.classList.add('vkui__portal-root');\n      body.appendChild(portal);\n      setPortalRoot(portal);\n      parentNode.classList.add('vkui__root', 'vkui__root--embedded');\n    } else {\n      parentNode.classList.add('vkui__root');\n    }\n\n    initialized.current = true;\n\n    return () => {\n      if (embedded) {\n        parentNode.classList.remove('vkui__root', 'vkui__root--embedded', 'vkui--sizeX-regular');\n        portal.parentElement.removeChild(portal);\n      } else {\n        parentNode.classList.remove('vkui__root');\n        body.classList.remove('vkui__root', 'vkui--sizeX-regular');\n        doc.classList.remove('vkui');\n      }\n    };\n  }, []);\n\n  // adaptivity handler\n  useIsomorphicLayoutEffect(\n    () => applyAdaptivityStyles(embedded ? rootRef.current.parentElement : document.body, sizeX),\n    [sizeX],\n  );\n\n  const scrollController = useMemo<ScrollContextInterface>(\n    () => scroll === 'contain' ? elementScrollController(rootRef) : globalScrollController(window, document),\n    [scroll]);\n\n  return (\n    <div ref={rootRef} vkuiClass={classNames('AppRoot', {\n      'AppRoot--no-mouse': !hasMouse,\n    })} {...props}>\n      <AppRootContext.Provider value={{\n        appRoot: rootRef,\n        portalRoot: portalRoot,\n        embedded,\n      }}>\n        <ScrollContext.Provider value={scrollController}>\n          <IconSettingsProvider classPrefix=\"vkui\" globalClasses={!noLegacyClasses}>\n            {children}\n          </IconSettingsProvider>\n        </ScrollContext.Provider>\n      </AppRootContext.Provider>\n    </div>\n  );\n};\n\nexport default withAdaptivity(AppRoot, {\n  sizeX: true,\n  hasMouse: true,\n});\n"],"file":"AppRoot.js"}