{"version":3,"sources":["../../../src/components/Alert/Alert.tsx"],"names":["React","Component","Tappable","PopoutWrapper","getClassName","classNames","transitionEvent","ANDROID","VKCOM","IOS","withPlatform","withAdaptivity","ViewWidth","Button","hasReactNode","Headline","Title","Caption","ModalDismissButton","Alert","props","item","action","autoclose","setState","closing","waitTransitionFinish","e","propertyName","onClose","stopPropagation","i","platform","mode","onItemClick","title","element","createRef","state","eventHandler","supported","current","removeEventListener","name","addEventListener","clearTimeout","transitionFinishTimeout","setTimeout","bind","header","text","actions","actionsLayout","children","className","style","viewWidth","restProps","resolvedActionsLayout","canShowCloseButton","SMALL_TABLET","isDesktop","renderHeader","renderText","map","renderAction"],"mappings":"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","sourcesContent":["import React, { Component, HTMLAttributes, MouseEventHandler, ReactNode, SyntheticEvent } from 'react';\nimport Tappable from '../Tappable/Tappable';\nimport PopoutWrapper from '../PopoutWrapper/PopoutWrapper';\nimport { getClassName } from '../../helpers/getClassName';\nimport { classNames } from '../../lib/classNames';\nimport { transitionEvent } from '../../lib/supportEvents';\nimport { ANDROID, VKCOM, IOS } from '../../lib/platform';\nimport { HasPlatform } from '../../types';\nimport { withPlatform } from '../../hoc/withPlatform';\nimport { withAdaptivity, AdaptivityProps, ViewWidth } from '../../hoc/withAdaptivity';\nimport Button from '../Button/Button';\nimport { hasReactNode } from '../../lib/utils';\nimport Headline from '../Typography/Headline/Headline';\nimport Title from '../Typography/Title/Title';\nimport Caption from '../Typography/Caption/Caption';\nimport ModalDismissButton from '../ModalDismissButton/ModalDismissButton';\n\nexport type AlertActionInterface = AlertProps['actions'][0];\n\nexport interface AlertProps extends HTMLAttributes<HTMLElement>, HasPlatform, AdaptivityProps {\n  actionsLayout?: 'vertical' | 'horizontal';\n  actions?: Array<{\n    title: string;\n    action?: VoidFunction;\n    autoclose?: boolean;\n    mode: 'cancel' | 'destructive' | 'default';\n  }>;\n  header?: ReactNode;\n  text?: ReactNode;\n  onClose?: VoidFunction;\n}\n\nexport interface AlertState {\n  closing: boolean;\n}\n\ntype TransitionEndHandler = (e?: TransitionEvent) => void;\n\ntype ItemClickHander = (item: AlertActionInterface) => () => void;\n\nclass Alert extends Component<AlertProps, AlertState> {\n  constructor(props: AlertProps) {\n    super(props);\n    this.element = React.createRef();\n    this.state = {\n      closing: false,\n    };\n  }\n\n  element: React.RefObject<HTMLDivElement>;\n\n  private transitionFinishTimeout: ReturnType<typeof setTimeout>;\n\n  static defaultProps: AlertProps = {\n    actionsLayout: 'horizontal',\n    actions: [],\n  };\n\n  onItemClick: ItemClickHander = (item: AlertActionInterface) => () => {\n    const { action, autoclose } = item;\n\n    if (autoclose) {\n      this.setState({ closing: true });\n      this.waitTransitionFinish((e?: TransitionEvent) => {\n        if (!e || e.propertyName === 'opacity') {\n          autoclose && this.props.onClose();\n          action && action();\n        }\n      });\n    } else {\n      action && action();\n    }\n  };\n\n  onClose: VoidFunction = () => {\n    this.setState({ closing: true });\n    this.waitTransitionFinish((e?: TransitionEvent) => {\n      if (!e || e.propertyName === 'opacity') {\n        this.props.onClose();\n      }\n    });\n  };\n\n  stopPropagation: MouseEventHandler = (e: SyntheticEvent) => {\n    e.stopPropagation();\n  };\n\n  waitTransitionFinish(eventHandler: TransitionEndHandler) {\n    if (transitionEvent.supported) {\n      this.element.current.removeEventListener(transitionEvent.name, eventHandler);\n      this.element.current.addEventListener(transitionEvent.name, eventHandler);\n    } else {\n      clearTimeout(this.transitionFinishTimeout);\n      this.transitionFinishTimeout = setTimeout(eventHandler.bind(this), this.props.platform === ANDROID || this.props.platform === VKCOM ? 200 : 300);\n    }\n  }\n\n  renderHeader(header: ReactNode) {\n    switch (this.props.platform) {\n      case VKCOM:\n        return <Headline vkuiClass=\"Alert__header\" weight=\"medium\">{header}</Headline>;\n      case IOS:\n        return <Title vkuiClass=\"Alert__header\" weight=\"semibold\" level=\"3\">{header}</Title>;\n      case ANDROID:\n        return <Title vkuiClass=\"Alert__header\" weight=\"medium\" level=\"2\">{header}</Title>;\n    }\n  }\n\n  renderText(text: ReactNode) {\n    switch (this.props.platform) {\n      case VKCOM:\n        return <Caption vkuiClass=\"Alert__text\" level=\"1\" weight=\"regular\">{text}</Caption>;\n      case IOS:\n        return <Caption vkuiClass=\"Alert__text\" level=\"2\" weight=\"regular\">{text}</Caption>;\n      case ANDROID:\n        return <Headline vkuiClass=\"Alert__text\" weight=\"regular\">{text}</Headline>;\n    }\n  }\n\n  renderAction = (action: AlertActionInterface, i: number) => {\n    const { platform } = this.props;\n    switch (platform) {\n      case ANDROID:\n        return (\n          <Button\n            vkuiClass={classNames('Alert__button', `Alert__button--${action.mode}`)}\n            mode=\"tertiary\"\n            size=\"m\"\n            onClick={this.onItemClick(action)}\n            key={`alert-action-${i}`}\n          >\n            {action.title}\n          </Button>\n        );\n      case VKCOM:\n        return (\n          <Button\n            vkuiClass={classNames('Alert__button', `Alert__button--${action.mode}`)}\n            size=\"m\"\n            mode={action.mode === 'cancel' ? 'secondary' : 'primary'}\n            onClick={this.onItemClick(action)}\n            key={`alert-action-${i}`}\n          >\n            {action.title}\n          </Button>\n        );\n      default:\n        return (\n          <Tappable\n            Component=\"button\"\n            vkuiClass={classNames('Alert__action', `Alert__action--${action.mode}`)}\n            onClick={this.onItemClick(action)}\n            key={`alert-action-${i}`}\n          >\n            {action.title}\n          </Tappable>\n        );\n    }\n  };\n\n  render() {\n    const { actions, actionsLayout, children, className, style, platform, viewWidth, text, header, ...restProps } = this.props;\n    const { closing } = this.state;\n\n    const resolvedActionsLayout: AlertProps['actionsLayout'] = platform === VKCOM ? 'horizontal' : actionsLayout;\n    const canShowCloseButton = platform === VKCOM || platform === ANDROID && viewWidth >= ViewWidth.SMALL_TABLET;\n    const isDesktop = viewWidth >= ViewWidth.SMALL_TABLET;\n\n    return (\n      <PopoutWrapper\n        className={className}\n        closing={closing}\n        style={style}\n        onClick={this.onClose}\n      >\n        <div\n          {...restProps}\n          ref={this.element}\n          onClick={this.stopPropagation}\n          vkuiClass={classNames(getClassName('Alert', platform), {\n            'Alert--v': resolvedActionsLayout === 'vertical',\n            'Alert--h': resolvedActionsLayout === 'horizontal',\n            'Alert--closing': closing,\n            'Alert--desktop': isDesktop,\n          })}\n        >\n          {canShowCloseButton && <ModalDismissButton onClick={this.onClose} />}\n          <div vkuiClass=\"Alert__content\">\n            {hasReactNode(header) && this.renderHeader(header)}\n            {hasReactNode(text) && this.renderText(text)}\n            {children}\n          </div>\n          <footer vkuiClass=\"Alert__actions\">\n            {actions.map(this.renderAction)}\n          </footer>\n        </div>\n      </PopoutWrapper>\n    );\n  }\n}\n\nexport default withPlatform(withAdaptivity(Alert, {\n  viewWidth: true,\n}));\n"],"file":"Alert.js"}