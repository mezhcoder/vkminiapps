{"version":3,"sources":["../../../src/components/Removable/Removable.tsx"],"names":["React","useCallback","useEffect","useRef","useState","classNames","getTitleFromChildren","usePlatform","getClassName","withAdaptivity","useDOM","ANDROID","IOS","VKCOM","Icon24Cancel","IconButton","Removable","props","children","sizeY","onRemove","removePlaceholder","align","restProps","platform","document","removeButtonRef","isRemoveActivated","setRemoveActivated","removeOffset","updateRemoveOffset","deactivateRemove","removeEventListener","onRemoveActivateClick","e","nativeEvent","stopPropagation","preventDefault","addEventListener","onRemoveClick","stopImmediatePropagation","current","offsetWidth","removePlaceholderString","transform","defaultProps"],"mappings":"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","sourcesContent":["import React, { AllHTMLAttributes, FC, ReactNode, MouseEvent, useCallback, useEffect, useRef, useState } from 'react';\nimport { classNames } from '../../lib/classNames';\nimport { getTitleFromChildren } from '../../lib/utils';\nimport { usePlatform } from '../../hooks/usePlatform';\nimport { getClassName } from '../../helpers/getClassName';\nimport { withAdaptivity, AdaptivityProps } from '../../hoc/withAdaptivity';\nimport { useDOM } from '../../lib/dom';\nimport { ANDROID, IOS, VKCOM } from '../../lib/platform';\nimport { Icon24Cancel } from '@vkontakte/icons';\nimport IconButton from '../IconButton/IconButton';\n\nexport interface RemovePlaceholderProps {\n  /**\n   * iOS only. Текст в выезжающей кнопке для удаления ячейки.\n   */\n  removePlaceholder?: ReactNode;\n}\n\ninterface RemovableProps extends AllHTMLAttributes<HTMLElement>, RemovePlaceholderProps {\n  /**\n   * Расположение кнопки удаления.\n   */\n  align?: 'start' | 'center';\n  onRemove?: (e: MouseEvent) => void;\n}\n\nexport const Removable: FC<RemovableProps> = withAdaptivity((props: RemovableProps & Pick<AdaptivityProps, 'sizeY'>) => {\n  const {\n    children,\n    sizeY,\n    onRemove,\n    removePlaceholder,\n    align,\n    ...restProps\n  } = props;\n  const platform = usePlatform();\n  const { document } = useDOM();\n\n  const removeButtonRef = useRef(null);\n\n  const [isRemoveActivated, setRemoveActivated] = useState(false);\n  const [removeOffset, updateRemoveOffset] = useState(0);\n\n  const deactivateRemove = useCallback(() => {\n    setRemoveActivated(false);\n    updateRemoveOffset(0);\n\n    document.removeEventListener('click', deactivateRemove);\n  }, [setRemoveActivated, updateRemoveOffset]);\n\n  const onRemoveActivateClick = (e: MouseEvent) => {\n    e.nativeEvent.stopPropagation();\n    e.preventDefault();\n    setRemoveActivated(true);\n\n    document.addEventListener('click', deactivateRemove);\n  };\n\n  const onRemoveClick = (e: MouseEvent) => {\n    e.nativeEvent.stopImmediatePropagation();\n    e.preventDefault();\n    onRemove && onRemove(e);\n  };\n\n  useEffect(() => {\n    if (isRemoveActivated && removeButtonRef?.current) {\n      updateRemoveOffset(removeButtonRef.current.offsetWidth);\n    }\n  }, [isRemoveActivated]);\n\n  useEffect(() => {\n    return () => {\n      document.removeEventListener('click', deactivateRemove);\n    };\n  }, [deactivateRemove]);\n\n  const removePlaceholderString: string = getTitleFromChildren(removePlaceholder);\n\n  return (\n    <div\n      {...restProps}\n      vkuiClass={classNames(\n        getClassName('Removable', platform),\n        `Removable--${align}`,\n        `Removable--sizeY-${sizeY}`,\n      )}\n    >\n      {(platform === ANDROID || platform === VKCOM) && (\n        <div vkuiClass=\"Removable__content\">\n          {children}\n\n          <IconButton\n            aria-label={removePlaceholderString}\n            vkuiClass=\"Removable__action Removable__action--remove\"\n            onClick={onRemoveClick}\n          >\n            <Icon24Cancel aria-hidden=\"true\" />\n          </IconButton>\n        </div>\n      )}\n\n      {platform === IOS && (\n        <React.Fragment>\n          <div vkuiClass=\"Removable__content\" style={{ transform: `translateX(-${removeOffset}px)` }}>\n            <button\n              aria-label={removePlaceholderString}\n              vkuiClass=\"Removable__action Removable__action--indicator\"\n              onClick={onRemoveActivateClick}\n            >\n              <i vkuiClass=\"Removable__action-in\" aria-hidden=\"true\" />\n            </button>\n\n            {children}\n\n            <span vkuiClass=\"Removable__offset\" aria-hidden=\"true\"></span>\n          </div>\n\n          <button\n            tabIndex={isRemoveActivated ? null : -1}\n            ref={removeButtonRef}\n            vkuiClass=\"Removable__action Removable__action--remove\"\n            onClick={onRemoveClick}\n            style={{ transform: `translateX(-${removeOffset}px)` }}\n          >\n            <span vkuiClass=\"Removable__action-in\">{removePlaceholder}</span>\n          </button>\n        </React.Fragment>\n      )}\n    </div>\n  );\n}, {\n  sizeY: true,\n});\n\nRemovable.defaultProps = {\n  align: 'center',\n  removePlaceholder: 'Удалить',\n};\n"],"file":"Removable.js"}