{"version":3,"sources":["../../../src/components/Snackbar/Snackbar.tsx"],"names":["useEffect","useRef","useState","Touch","classNames","getClassName","canUseDOM","ANDROID","VKCOM","rubber","withAdaptivity","ViewWidth","Text","Button","AppRootPortal","useWaitTransitionFinish","usePlatform","SnackbarComponent","props","children","layout","action","before","after","viewWidth","duration","onActionClick","onClose","restProps","platform","waitTransitionFinish","closing","setClosing","touched","setTouched","shiftXPercentRef","shiftXCurrentRef","touchStartTimeRef","bodyElRef","innerElRef","closeTimeoutRef","animationFrameRef","isDesktop","SMALL_TABLET","transitionFinishDurationFallback","close","current","handleActionClick","e","setCloseTimeout","setTimeout","clearCloseTimeout","clearTimeout","setBodyTransform","percent","cancelAnimationFrame","requestAnimationFrame","style","transform","onTouchStart","onTouchMoveX","event","shiftX","startT","originalEvent","preventDefault","offsetWidth","onTouchEnd","callback","shiftXCurrent","expectTranslateY","Date","now","getTime","resolvedLayout","displayName","defaultProps","Snackbar"],"mappings":"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","sourcesContent":["import React, {\n  FC,\n  HTMLAttributes,\n  MouseEventHandler,\n  useEffect,\n  useRef,\n  useState,\n} from 'react';\nimport Touch, { TouchEvent } from '../Touch/Touch';\nimport { classNames } from '../../lib/classNames';\nimport { HasPlatform } from '../../types';\nimport { getClassName } from '../../helpers/getClassName';\nimport { canUseDOM } from '../../lib/dom';\nimport { ANDROID, VKCOM } from '../../lib/platform';\nimport { rubber } from '../../lib/touch';\nimport { withAdaptivity, AdaptivityProps, ViewWidth } from '../../hoc/withAdaptivity';\nimport Text from '../Typography/Text/Text';\nimport Button from '../Button/Button';\nimport { AppRootPortal } from '../AppRoot/AppRootPortal';\nimport { useWaitTransitionFinish } from '../../hooks/useWaitTransitionFinish';\nimport { usePlatform } from '../../hooks/usePlatform';\n\nexport interface SnackbarProps extends HTMLAttributes<HTMLElement>, HasPlatform, AdaptivityProps {\n  /**\n   * Название кнопки действия в уведомлении\n   */\n  action?: string | React.ComponentType;\n\n  /**\n   * Будет вызвано при клике на кнопку действия\n   */\n  onActionClick?: (e: React.MouseEvent) => void;\n\n  /**\n   * Цветная иконка 24x24 пикселя\n   */\n  before?: React.ReactNode;\n  /**\n   * Контент в правой части, может быть `<Avatar size={32} />`\n   */\n  after?: React.ReactNode;\n  /**\n   * Варианты расположения кнопки\n   */\n  layout?: 'vertical' | 'horizontal';\n  /**\n   * Время в миллисекундах, через которое плашка скроется\n   */\n  duration?: number;\n  /**\n   * Обработчик закрытия уведомления\n   */\n  onClose: () => void;\n}\n\nconst SnackbarComponent: FC<SnackbarProps> = (props: SnackbarProps) => {\n  const {\n    children,\n    layout,\n    action,\n    before,\n    after,\n    viewWidth,\n    duration,\n    onActionClick,\n    onClose,\n    ...restProps\n  } = props;\n\n  const platform = usePlatform();\n\n  const { waitTransitionFinish } = useWaitTransitionFinish();\n\n  const [closing, setClosing] = useState(false);\n  const [touched, setTouched] = useState(false);\n\n  const shiftXPercentRef = useRef<number>(0);\n  const shiftXCurrentRef = useRef<number>(0);\n  const touchStartTimeRef = useRef<Date | null>(null);\n\n  const bodyElRef = useRef<HTMLDivElement | null>(null);\n  const innerElRef = useRef<HTMLDivElement | null>(null);\n\n  const closeTimeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n  const animationFrameRef = useRef<ReturnType<typeof requestAnimationFrame> | null>(null);\n\n  const isDesktop = viewWidth >= ViewWidth.SMALL_TABLET;\n  const transitionFinishDurationFallback = platform === ANDROID || platform === VKCOM ? 400 : 320;\n\n  const close = () => {\n    setClosing(true);\n    waitTransitionFinish(innerElRef.current, () => {\n      onClose();\n    }, transitionFinishDurationFallback);\n  };\n\n  const handleActionClick: MouseEventHandler<HTMLElement> = (e) => {\n    close();\n\n    if (action && typeof onActionClick === 'function') {\n      onActionClick(e);\n    }\n  };\n\n  const setCloseTimeout = () => {\n    if (canUseDOM) {\n      closeTimeoutRef.current = setTimeout(() => {\n        close();\n      }, duration);\n    }\n  };\n\n  const clearCloseTimeout = () => {\n    clearTimeout(closeTimeoutRef.current);\n  };\n\n  const setBodyTransform = (percent: number) => {\n    cancelAnimationFrame(animationFrameRef.current);\n    animationFrameRef.current = requestAnimationFrame(() => {\n      if (bodyElRef.current) {\n        bodyElRef.current.style.transform = `translate3d(${percent}%, 0, 0)`;\n      }\n    });\n  };\n\n  const onTouchStart = () => {\n    clearCloseTimeout();\n  };\n\n  const onTouchMoveX = (event: TouchEvent) => {\n    const { shiftX, startT, originalEvent } = event;\n    originalEvent.preventDefault();\n\n    if (!touched) {\n      setTouched(true);\n    }\n\n    shiftXPercentRef.current = shiftX / bodyElRef.current.offsetWidth * 100;\n    shiftXCurrentRef.current = rubber(shiftXPercentRef.current, 72, 1.2, platform === ANDROID || platform === VKCOM);\n    touchStartTimeRef.current = startT;\n\n    setBodyTransform(shiftXCurrentRef.current);\n  };\n\n  const onTouchEnd = () => {\n    let callback: VoidFunction | undefined;\n\n    if (touched) {\n      let shiftXCurrent = shiftXCurrentRef.current;\n      const expectTranslateY = shiftXCurrent / (Date.now() - touchStartTimeRef.current.getTime()) * 240 * 0.6;\n      shiftXCurrent = shiftXCurrent + expectTranslateY;\n\n      if (isDesktop && shiftXCurrent <= -50) {\n        clearCloseTimeout();\n        waitTransitionFinish(bodyElRef.current, () => {\n          onClose();\n        }, transitionFinishDurationFallback);\n        setBodyTransform(-120);\n      } else if (!isDesktop && shiftXCurrent >= 50) {\n        clearCloseTimeout();\n        waitTransitionFinish(bodyElRef.current, () => {\n          onClose();\n        }, transitionFinishDurationFallback);\n        setBodyTransform(120);\n      } else {\n        callback = () => {\n          setCloseTimeout();\n          setBodyTransform(0);\n        };\n      }\n    } else {\n      setCloseTimeout();\n    }\n\n    setTouched(false);\n    callback && requestAnimationFrame(callback);\n  };\n\n  useEffect(() => {\n    setCloseTimeout();\n\n    return () => {\n      clearCloseTimeout();\n    };\n  }, []);\n\n  const resolvedLayout = after || isDesktop ? 'vertical' : layout;\n\n  return (\n    <AppRootPortal>\n      <div\n        {...restProps}\n        vkuiClass={classNames(getClassName('Snackbar', platform), `Snackbar--l-${resolvedLayout}`, {\n          'Snackbar--closing': closing,\n          'Snackbar--touched': touched,\n          'Snackbar--desktop': isDesktop,\n        })}\n      >\n        <Touch\n          vkuiClass=\"Snackbar__in\"\n          getRootRef={innerElRef}\n          onStart={onTouchStart}\n          onMoveX={onTouchMoveX}\n          onEnd={onTouchEnd}\n        >\n          <div vkuiClass=\"Snackbar__body\" ref={bodyElRef}>\n            {before &&\n            <div vkuiClass=\"Snackbar__before\">\n              {before}\n            </div>}\n\n            <div vkuiClass=\"Snackbar__content\">\n              <Text weight=\"regular\" vkuiClass=\"Snackbar__content-text\">{children}</Text>\n\n              {action &&\n              <Button align=\"left\" hasHover={false} mode=\"tertiary\" size=\"s\" vkuiClass=\"Snackbar__action\" onClick={handleActionClick}>\n                {action}\n              </Button>}\n            </div>\n\n            {after &&\n            <div vkuiClass=\"Snackbar__after\">\n              {after}\n            </div>}\n          </div>\n        </Touch>\n      </div>\n    </AppRootPortal>\n  );\n};\n\nSnackbarComponent.displayName = 'Snackbar';\n\nSnackbarComponent.defaultProps = {\n  duration: 4000,\n  layout: 'horizontal',\n};\n\nexport const Snackbar = withAdaptivity(SnackbarComponent, {\n  viewWidth: true,\n});\n"],"file":"Snackbar.js"}