{"version":3,"sources":["../../../src/components/ConfigProvider/ConfigProvider.tsx"],"names":["useRef","canUseDOM","useDOM","ConfigProviderContext","Scheme","defaultConfigProviderProps","VKCOM","useIsomorphicLayoutEffect","useObjectMemo","noop","mapOldScheme","scheme","DEPRECATED_CLIENT_LIGHT","BRIGHT_LIGHT","DEPRECATED_CLIENT_DARK","SPACE_GRAY","ConfigProvider","children","config","platform","document","setScheme","body","setAttribute","isMounted","current","removeAttribute","configContext","defaultProps"],"mappings":";;;;;;;;AAAA,SAAaA,MAAb,QAA2B,OAA3B;AACA,SAASC,SAAT,EAAoBC,MAApB;AACA,SACEC,qBADF,EAGEC,MAHF,EAKEC,0BALF;AAOA,SAASC,KAAT;AACA,SAASC,yBAAT;AACA,SAASC,aAAT;AACA,SAASC,IAAT;;AASA,SAASC,YAAT,CAAsBC,MAAtB,EAAkE;AAChE,UAAQA,MAAR;AACE,SAAKP,MAAM,CAACQ,uBAAZ;AACE,aAAOR,MAAM,CAACS,YAAd;;AACF,SAAKT,MAAM,CAACU,sBAAZ;AACE,aAAOV,MAAM,CAACW,UAAd;;AACF;AACE,aAAOJ,MAAP;AANJ;AAQD;;AAED,IAAMK,cAAuC,GAAG,SAA1CA,cAA0C,OAA6B;AAAA,MAA1BC,QAA0B,QAA1BA,QAA0B;AAAA,MAAbC,MAAa;;AAC3E,MAAMP,MAAM,GAAGO,MAAM,CAACC,QAAP,KAAoBb,KAApB,GAA4BF,MAAM,CAACE,KAAnC,GAA2CI,YAAY,CAACQ,MAAM,CAACP,MAAR,CAAtE;;AAD2E,gBAGtDT,MAAM,EAHgD;AAAA,MAGnEkB,QAHmE,WAGnEA,QAHmE;;AAI3E,MAAMC,SAAS,GAAG,SAAZA,SAAY,GAAM;AACtB,QAAIV,MAAM,KAAK,SAAf,EAA0B;AACxBS,MAAAA,QAAQ,CAACE,IAAT,CAAcC,YAAd,CAA2B,QAA3B,EAAqCZ,MAArC;AACD;AACF,GAJD;;AAMA,MAAMa,SAAS,GAAGxB,MAAM,CAAC,KAAD,CAAxB;;AACA,MAAI,CAACwB,SAAS,CAACC,OAAX,IAAsBxB,SAA1B,EAAqC;AACnCoB,IAAAA,SAAS;AACTG,IAAAA,SAAS,CAACC,OAAV,GAAoB,IAApB;AACD;;AACDlB,EAAAA,yBAAyB,CAAC,YAAM;AAC9Bc,IAAAA,SAAS;AACT,WAAOV,MAAM,KAAK,SAAX,GAAuBF,IAAvB,GAA8B;AAAA,aAAMW,QAAQ,CAACE,IAAT,CAAcI,eAAd,CAA8B,QAA9B,CAAN;AAAA,KAArC;AACD,GAHwB,EAGtB,CAACf,MAAD,CAHsB,CAAzB;AAKA,MAAMgB,aAAa,GAAGnB,aAAa,CAACU,MAAD,CAAnC;AAEA,SACE,oBAAC,qBAAD,CAAuB,QAAvB;AAAgC,IAAA,KAAK,EAAES;AAAvC,KACGV,QADH,CADF;AAKD,CA3BD,C,CA6BA;AACA;;;AACAD,cAAc,CAACY,YAAf,qBAAmCvB,0BAAnC;AAEA,eAAeW,cAAf","sourcesContent":["import { FC, useRef } from 'react';\nimport { canUseDOM, useDOM } from '../../lib/dom';\nimport {\n  ConfigProviderContext,\n  ConfigProviderContextInterface,\n  Scheme,\n  AppearanceScheme,\n  defaultConfigProviderProps,\n} from './ConfigProviderContext';\nimport { VKCOM } from '../../lib/platform';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { useObjectMemo } from '../../hooks/useObjectMemo';\nimport { noop } from '../../lib/utils';\n\nexport interface ConfigProviderProps extends ConfigProviderContextInterface {\n  /**\n   * Цветовая схема приложения\n   */\n  scheme?: AppearanceScheme;\n}\n\nfunction mapOldScheme(scheme: AppearanceScheme): AppearanceScheme {\n  switch (scheme) {\n    case Scheme.DEPRECATED_CLIENT_LIGHT:\n      return Scheme.BRIGHT_LIGHT;\n    case Scheme.DEPRECATED_CLIENT_DARK:\n      return Scheme.SPACE_GRAY;\n    default:\n      return scheme;\n  }\n}\n\nconst ConfigProvider: FC<ConfigProviderProps> = ({ children, ...config }) => {\n  const scheme = config.platform === VKCOM ? Scheme.VKCOM : mapOldScheme(config.scheme);\n\n  const { document } = useDOM();\n  const setScheme = () => {\n    if (scheme !== 'inherit') {\n      document.body.setAttribute('scheme', scheme);\n    }\n  };\n\n  const isMounted = useRef(false);\n  if (!isMounted.current && canUseDOM) {\n    setScheme();\n    isMounted.current = true;\n  }\n  useIsomorphicLayoutEffect(() => {\n    setScheme();\n    return scheme === 'inherit' ? noop : () => document.body.removeAttribute('scheme');\n  }, [scheme]);\n\n  const configContext = useObjectMemo(config);\n\n  return (\n    <ConfigProviderContext.Provider value={configContext}>\n      {children}\n    </ConfigProviderContext.Provider>\n  );\n};\n\n// Деструктуризация нужна из бага в react-docgen-typescript\n// https://github.com/styleguidist/react-docgen-typescript/issues/195\nConfigProvider.defaultProps = { ...defaultConfigProviderProps };\n\nexport default ConfigProvider;\n"],"file":"ConfigProvider.js"}