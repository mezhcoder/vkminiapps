{"version":3,"sources":["../../../../src/components/ModalRoot/ModalRootDesktop.tsx"],"names":["ModalRootDesktopComponent","props","e","key","triggerActiveModalClose","document","removeEventListener","handleKeyDownEsc","activeTransitions","Math","max","activeModal","state","nextModal","newState","prevModal","visibleModals","animated","switching","history","setState","activeModalState","modalsState","doCloseModal","modalState","onClose","id","console","error","isBack","inited","maskElementRef","React","createRef","initModalsState","modalRootContext","updateModalHeight","undefined","registerModal","data","Object","assign","isInsideModal","modals","reduce","acc","Modal","modalProps","dynamicContentHeight","settlingHeight","initActiveModal","addEventListener","prevProps","prevState","warn","includes","splice","indexOf","push","closeActiveModal","requestAnimationFrame","switchPrevNext","type","ModalType","PAGE","CARD","prevModalState","waitTransitionFinish","prevNextSwitchEndHandler","animateModalOpacity","setMaskOpacity","eventHandler","transitionEvent","supported","onceHandler","innerElement","name","setTimeout","platform","ANDROID","VKCOM","nextModalState","prevIsCard","nextIsPage","nextIsCard","display","style","opacity","forceOpacity","cancelAnimationFrame","maskAnimationFrame","current","translateY","translateYCurrent","min","toString","configProvider","webviewType","WebviewType","VKAPPS","map","modalId","window","Children","toArray","children","Component","ModalRootDesktop","ConfigProviderContext"],"mappings":"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","sourcesContent":["import React, { Children, Component, ReactElement } from 'react';\nimport { classNames } from '../../lib/classNames';\nimport { isFunction } from '../../lib/utils';\nimport { transitionEvent } from '../../lib/supportEvents';\nimport { HasPlatform } from '../../types';\nimport { withPlatform } from '../../hoc/withPlatform';\nimport { withContext } from '../../hoc/withContext';\nimport ModalRootContext, { ModalRootContextInterface } from './ModalRootContext';\nimport {\n  ConfigProviderContext,\n  ConfigProviderContextInterface,\n  WebviewType,\n} from '../ConfigProvider/ConfigProviderContext';\nimport { ModalsStateEntry, ModalType } from './types';\nimport { ANDROID, VKCOM } from '../../lib/platform';\nimport { getClassName } from '../../helpers/getClassName';\nimport { DOMProps, withDOM } from '../../lib/dom';\nimport { getNavId } from '../../lib/getNavId';\n\nexport interface ModalRootProps extends HasPlatform {\n  activeModal?: string | null;\n  /**\n   * @ignore\n   */\n  configProvider?: ConfigProviderContextInterface;\n\n  /**\n   * Будет вызвано при закрытии активной модалки с её id\n   */\n  onClose?(modalId: string): void;\n}\n\ninterface ModalRootState {\n  activeModal?: string;\n  prevModal?: string;\n  nextModal?: string;\n  visibleModals?: string[];\n  animated?: boolean;\n  switching?: boolean;\n  history?: string[];\n  isBack?: boolean;\n  inited?: boolean;\n}\n\nclass ModalRootDesktopComponent extends Component<ModalRootProps & DOMProps, ModalRootState> {\n  constructor(props: ModalRootProps) {\n    super(props);\n\n    const activeModal = props.activeModal;\n\n    this.state = {\n      activeModal: null,\n      prevModal: null,\n      nextModal: activeModal,\n      visibleModals: activeModal ? [activeModal] : [],\n      animated: !!activeModal,\n      switching: false,\n      history: activeModal ? [activeModal] : [],\n      isBack: false,\n      inited: false,\n    };\n\n    this.maskElementRef = React.createRef();\n    this.activeTransitions = 0;\n\n    this.initModalsState();\n\n    this.modalRootContext = {\n      updateModalHeight: () => undefined,\n      registerModal: ({ id, ...data }) => Object.assign(this.modalsState[id], data),\n      onClose: this.triggerActiveModalClose,\n      isInsideModal: true,\n    };\n  }\n\n  private modalsState: { [id: string]: ModalsStateEntry };\n  private readonly maskElementRef: React.RefObject<HTMLDivElement>;\n  private maskAnimationFrame: number;\n  private readonly modalRootContext: ModalRootContextInterface;\n\n  activeTransitions: number;\n\n  get document(): Document {\n    return this.props.document;\n  }\n\n  get window(): Window {\n    return this.props.window;\n  }\n\n  get modals() {\n    return Children.toArray(this.props.children) as ReactElement[];\n  }\n\n  initModalsState() {\n    this.modalsState = this.modals.reduce<{ [id: string]: ModalsStateEntry }>((acc, Modal) => {\n      const modalProps = Modal.props;\n      const state: ModalsStateEntry = {\n        id: getNavId(Modal.props),\n        onClose: Modal.props.onClose,\n        dynamicContentHeight: !!modalProps.dynamicContentHeight,\n      };\n\n      // ModalPage props\n      if (typeof modalProps.settlingHeight === 'number') {\n        state.settlingHeight = modalProps.settlingHeight;\n      }\n\n      acc[state.id] = state;\n      return acc;\n    }, {});\n  }\n\n  handleKeyDownEsc = (e: KeyboardEvent): void => {\n    if (e.key === 'Escape') {\n      this.triggerActiveModalClose();\n    }\n  };\n\n  componentDidMount() {\n    this.initActiveModal();\n    document.addEventListener('keydown', this.handleKeyDownEsc);\n  }\n\n  componentWillUnmount = () => {\n    document.removeEventListener('keydown', this.handleKeyDownEsc);\n  };\n\n  componentDidUpdate(prevProps: ModalRootProps, prevState: ModalRootState) {\n    if (this.props.activeModal !== prevProps.activeModal) {\n      const nextModal = this.props.activeModal;\n      const prevModal = prevProps.activeModal;\n\n      if (nextModal !== null && !this.modalsState[nextModal]) {\n        return console.warn(`[ModalRoot.componentDidUpdate] nextModal ${nextModal} not found`);\n      }\n\n      let history = [...this.state.history];\n      let isBack = false;\n\n      if (nextModal === null) {\n        history = [];\n      } else if (history.includes(nextModal)) {\n        history = history.splice(0, history.indexOf(nextModal) + 1);\n        isBack = true;\n      } else {\n        history.push(nextModal);\n      }\n\n      return this.setState({\n        activeModal: null,\n        nextModal,\n        prevModal,\n        visibleModals: [nextModal, prevModal],\n        history,\n        isBack,\n        animated: true,\n        inited: false,\n        switching: false,\n      }, () => {\n        if (nextModal === null) {\n          this.closeActiveModal();\n        } else {\n          this.initActiveModal();\n        }\n      });\n    }\n\n    if (this.state.switching && !prevState.switching) {\n      requestAnimationFrame(() => this.switchPrevNext());\n    }\n  }\n\n  /**\n   * Инициализирует модалку перед анимацией открытия\n   */\n  initActiveModal() {\n    const activeModal = this.state.activeModal || this.state.nextModal;\n    if (!activeModal) {\n      return;\n    }\n\n    const modalState = this.modalsState[activeModal];\n\n    switch (modalState.type) {\n      case ModalType.PAGE:\n        modalState.settlingHeight = modalState.settlingHeight || 75;\n        break;\n\n      case ModalType.CARD:\n        break;\n\n      default:\n        console.warn('[ModalRoot.initActiveModal] modalState.type is unknown');\n    }\n\n    this.setState({ inited: true, switching: true });\n  }\n\n  closeActiveModal() {\n    const { prevModal } = this.state;\n    if (!prevModal) {\n      return console.warn(`[ModalRoot.closeActiveModal] prevModal is ${prevModal}`);\n    }\n\n    const prevModalState = this.modalsState[prevModal];\n\n    this.waitTransitionFinish(prevModalState, this.prevNextSwitchEndHandler);\n    this.animateModalOpacity(prevModalState, false);\n    this.setMaskOpacity(prevModalState, 0);\n  }\n\n  waitTransitionFinish(modalState: ModalsStateEntry, eventHandler: () => void) {\n    if (transitionEvent.supported) {\n      const onceHandler = () => {\n        modalState.innerElement.removeEventListener(transitionEvent.name, onceHandler);\n        eventHandler();\n      };\n\n      modalState.innerElement.addEventListener(transitionEvent.name, onceHandler);\n    } else {\n      setTimeout(eventHandler, this.props.platform === ANDROID || this.props.platform === VKCOM ? 320 : 400);\n    }\n  }\n\n  switchPrevNext() {\n    const { prevModal, nextModal } = this.state;\n\n    const prevModalState = this.modalsState[prevModal];\n    const nextModalState = this.modalsState[nextModal];\n\n    if (!prevModalState && !nextModalState) {\n      return console.warn(`[ModalRoot.switchPrevNext] prevModal is ${prevModal}, nextModal is ${nextModal}`);\n    }\n\n    const prevIsCard = !!prevModalState && prevModalState.type === ModalType.CARD;\n\n    const nextIsPage = !!nextModalState && nextModalState.type === ModalType.PAGE;\n    const nextIsCard = !!nextModalState && nextModalState.type === ModalType.CARD;\n\n    // Ждём полного скрытия предыдущей модалки\n    if (prevModalState && (nextIsCard || prevIsCard && nextIsPage)) {\n      this.activeTransitions += 1;\n      this.waitTransitionFinish(prevModalState, () => {\n        this.waitTransitionFinish(nextModalState, this.prevNextSwitchEndHandler);\n        this.animateModalOpacity(nextModalState, true);\n      });\n\n      requestAnimationFrame(() => {\n        this.animateModalOpacity(prevModalState, false);\n      });\n\n      return;\n    }\n\n    if (prevModalState && nextIsPage) {\n      this.activeTransitions += 1;\n      this.waitTransitionFinish(prevModalState, this.prevNextSwitchEndHandler);\n      requestAnimationFrame(() => {\n        this.animateModalOpacity(prevModalState, false);\n      });\n    }\n\n    this.activeTransitions += 1;\n    this.waitTransitionFinish(nextModalState, this.prevNextSwitchEndHandler);\n    requestAnimationFrame(() => {\n      this.animateModalOpacity(nextModalState, true);\n    });\n  }\n\n  prevNextSwitchEndHandler = () => {\n    this.activeTransitions = Math.max(0, this.activeTransitions - 1);\n    if (this.activeTransitions > 0) {\n      return;\n    }\n\n    const activeModal = this.state.nextModal;\n\n    const newState: ModalRootState = {\n      prevModal: null,\n      nextModal: null,\n      visibleModals: [activeModal],\n      activeModal: activeModal,\n      animated: false,\n      switching: false,\n    };\n\n    if (!activeModal) {\n      newState.history = [];\n    }\n\n    this.setState(newState);\n  };\n\n  /* Анимирует сдивг модалки */\n  animateModalOpacity(modalState: ModalsStateEntry, display: boolean) {\n    modalState.innerElement.style.opacity = display ? '1' : '0';\n  }\n\n  /* Устанавливает прозрачность для полупрозрачной подложки */\n  setMaskOpacity(modalState: ModalsStateEntry, forceOpacity: number = null) {\n    if (forceOpacity === null && this.state.history[0] !== modalState.id) {\n      return;\n    }\n\n    cancelAnimationFrame(this.maskAnimationFrame);\n    this.maskAnimationFrame = requestAnimationFrame(() => {\n      if (this.maskElementRef.current) {\n        const { translateY, translateYCurrent } = modalState;\n\n        const opacity = forceOpacity === null ? 1 - (translateYCurrent - translateY) / (100 - translateY) || 0 : forceOpacity;\n        this.maskElementRef.current.style.opacity = Math.max(0, Math.min(100, opacity)).toString();\n      }\n    });\n  }\n\n  /**\n   * Закрывает текущую модалку\n   */\n  triggerActiveModalClose = () => {\n    const activeModalState = this.modalsState[this.state.activeModal];\n    if (activeModalState) {\n      this.doCloseModal(activeModalState);\n    }\n  };\n\n  private readonly doCloseModal = (modalState: ModalsStateEntry) => {\n    if (isFunction(modalState.onClose)) {\n      modalState.onClose();\n    } else if (isFunction(this.props.onClose)) {\n      this.props.onClose(modalState.id);\n    } else {\n      console.error('[ModalRoot] onClose is undefined');\n    }\n  };\n\n  render() {\n    const { prevModal, activeModal, nextModal, visibleModals, animated } = this.state;\n\n    if (!activeModal && !prevModal && !nextModal && !animated) {\n      return null;\n    }\n\n    return (\n      <ModalRootContext.Provider value={this.modalRootContext}>\n        <div\n          vkuiClass={classNames(getClassName('ModalRoot', this.props.platform), {\n            'ModalRoot--vkapps': this.props.configProvider.webviewType === WebviewType.VKAPPS,\n          }, 'ModalRoot--desktop')}\n        >\n          <div\n            vkuiClass=\"ModalRoot__mask\"\n            onClick={this.triggerActiveModalClose}\n            ref={this.maskElementRef}\n          />\n          <div vkuiClass=\"ModalRoot__viewport\">\n            {this.modals.map((Modal: ReactElement) => {\n              const modalId = getNavId(Modal.props);\n              if (!visibleModals.includes(modalId)) {\n                return null;\n              }\n\n              const key = `modal-${modalId}`;\n\n              return (\n                <div\n                  key={key}\n                  vkuiClass={classNames('ModalRoot__modal', {\n                    'ModalRoot__modal--active': modalId === activeModal,\n                    'ModalRoot__modal--prev': modalId === prevModal,\n                    'ModalRoot__modal--next': modalId === nextModal,\n                  })}\n                >{Modal}</div>\n              );\n            })}\n          </div>\n        </div>\n      </ModalRootContext.Provider>\n    );\n  }\n}\n\nexport const ModalRootDesktop = withContext(withPlatform(withDOM<ModalRootProps>(ModalRootDesktopComponent)), ConfigProviderContext, 'configProvider');\n"],"file":"ModalRootDesktop.js"}