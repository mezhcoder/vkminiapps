{"version":3,"sources":["../../../../src/components/AppRoot/AppRoot.tsx"],"names":["applyAdaptivityStyles","container","sizeX","SizeType","REGULAR","classList","add","remove","AppRoot","children","embedded","hasMouse","noLegacyClasses","scroll","props","rootRef","portalRoot","setPortalRoot","window","document","initialized","current","documentElement","classScopingMode","noConflict","console","warn","doc","body","parentNode","parentElement","portal","createElement","appendChild","removeChild","scrollController","appRoot"],"mappings":"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","sourcesContent":["import { FC, HTMLAttributes, useEffect, useMemo, useRef, useState } from 'react';\nimport { useDOM } from '../../lib/dom';\nimport { classNames } from '../../lib/classNames';\nimport { AppRootContext } from './AppRootContext';\nimport { withAdaptivity, SizeType, AdaptivityProps } from '../../hoc/withAdaptivity';\nimport { useIsomorphicLayoutEffect } from '../../lib/useIsomorphicLayoutEffect';\nimport { classScopingMode } from '../../lib/classScopingMode';\nimport { IconSettingsProvider } from '@vkontakte/icons';\nimport { elementScrollController, globalScrollController, ScrollContext, ScrollContextInterface } from './ScrollContext';\n\n// Используйте classList, но будьте осторожны\n/* eslint-disable no-restricted-properties */\n\nexport interface AppRootProps extends HTMLAttributes<HTMLDivElement>, AdaptivityProps {\n  embedded?: boolean;\n  window?: Window;\n  /** Убирает классы без префикса (.Button) */\n  noLegacyClasses?: boolean;\n  scroll?: 'global' | 'contain';\n}\n\nfunction applyAdaptivityStyles(container: HTMLElement, sizeX: SizeType) {\n  if (sizeX === SizeType.REGULAR) {\n    container.classList.add('vkui--sizeX-regular');\n  } else {\n    container.classList.remove('vkui--sizeX-regular');\n  }\n}\n\nconst AppRoot: FC<AppRootProps> = ({ children, embedded, sizeX, hasMouse, noLegacyClasses = false, scroll = 'global', ...props }) => {\n  const rootRef = useRef<HTMLDivElement>();\n  const [portalRoot, setPortalRoot] = useState<HTMLDivElement>(null);\n  const { window, document } = useDOM();\n\n  const initialized = useRef(false);\n\n  if (!initialized.current) {\n    if (window && !embedded) {\n      document.documentElement.classList.add('vkui');\n    }\n    classScopingMode.noConflict = noLegacyClasses;\n  }\n\n  useEffect(() => {\n    if (scroll !== 'global' && !embedded) {\n      console.warn('[VKUI/AppRoot] Scroll modes only supported in embedded mode');\n    }\n  }, [scroll]);\n\n  // one time initialization and cleanup\n  useIsomorphicLayoutEffect(() => {\n    const doc = document.documentElement;\n    const body = document.body;\n    const parentNode = rootRef.current.parentElement;\n\n    let portal: HTMLDivElement;\n    if (embedded) {\n      portal = document.createElement('div');\n      portal.classList.add('vkui__portal-root');\n      body.appendChild(portal);\n      setPortalRoot(portal);\n      parentNode.classList.add('vkui__root', 'vkui__root--embedded');\n    } else {\n      parentNode.classList.add('vkui__root');\n    }\n\n    initialized.current = true;\n\n    return () => {\n      if (embedded) {\n        parentNode.classList.remove('vkui__root', 'vkui__root--embedded', 'vkui--sizeX-regular');\n        portal.parentElement.removeChild(portal);\n      } else {\n        parentNode.classList.remove('vkui__root');\n        body.classList.remove('vkui__root', 'vkui--sizeX-regular');\n        doc.classList.remove('vkui');\n      }\n    };\n  }, []);\n\n  // adaptivity handler\n  useIsomorphicLayoutEffect(\n    () => applyAdaptivityStyles(embedded ? rootRef.current.parentElement : document.body, sizeX),\n    [sizeX],\n  );\n\n  const scrollController = useMemo<ScrollContextInterface>(\n    () => scroll === 'contain' ? elementScrollController(rootRef) : globalScrollController(window, document),\n    [scroll]);\n\n  return (\n    <div ref={rootRef} vkuiClass={classNames('AppRoot', {\n      'AppRoot--no-mouse': !hasMouse,\n    })} {...props}>\n      <AppRootContext.Provider value={{\n        appRoot: rootRef,\n        portalRoot: portalRoot,\n        embedded,\n      }}>\n        <ScrollContext.Provider value={scrollController}>\n          <IconSettingsProvider classPrefix=\"vkui\" globalClasses={!noLegacyClasses}>\n            {children}\n          </IconSettingsProvider>\n        </ScrollContext.Provider>\n      </AppRootContext.Provider>\n    </div>\n  );\n};\n\nexport default withAdaptivity(AppRoot, {\n  sizeX: true,\n  hasMouse: true,\n});\n"],"file":"AppRoot.js"}