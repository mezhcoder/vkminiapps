{"version":3,"sources":["../../../../src/components/Textarea/Textarea.tsx"],"names":["Textarea","props","element","getRef","el","offsetHeight","scrollHeight","style","window","getComputedStyle","paddingTop","parseInt","paddingBottom","diff","value","setState","height","onResize","e","isControlledOutside","target","onChange","state","defaultValue","grow","resize","prevProps","prevState","requestAnimationFrame","className","getRootRef","sizeY","platform","restProps","disabled","PureComponent"],"mappings":"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","sourcesContent":["import { ChangeEvent, ChangeEventHandler, PureComponent, TextareaHTMLAttributes, RefCallback } from 'react';\nimport { classNames } from '../../lib/classNames';\nimport FormField from '../FormField/FormField';\nimport { HasRef, HasRootRef } from '../../types';\nimport { setRef } from '../../lib/utils';\nimport { withAdaptivity, AdaptivityProps } from '../../hoc/withAdaptivity';\nimport { getClassName, HasPlatform } from '../..';\nimport { withPlatform } from '../../hoc/withPlatform';\n\nexport interface TextareaProps extends\n  TextareaHTMLAttributes<HTMLTextAreaElement>,\n  HasRef<HTMLTextAreaElement>,\n  HasRootRef<HTMLElement>,\n  AdaptivityProps,\n  HasPlatform {\n  grow?: boolean;\n  onResize?(el: HTMLTextAreaElement): void;\n  defaultValue?: string;\n}\n\nexport interface TextareaState {\n  value?: string;\n  height?: number;\n}\n\nclass Textarea extends PureComponent<TextareaProps, TextareaState> {\n  constructor(props: TextareaProps) {\n    super(props);\n\n    if (typeof props.value !== 'undefined') {\n      this.isControlledOutside = true;\n      this.state = {};\n    } else {\n      this.state = {\n        value: props.defaultValue || '',\n      };\n    }\n  }\n\n  isControlledOutside?: boolean;\n  element: HTMLTextAreaElement;\n\n  componentDidMount() {\n    if (this.props.grow) {\n      this.resize();\n    }\n  }\n\n  static defaultProps: TextareaProps = {\n    style: {},\n    defaultValue: '',\n    grow: true,\n  };\n\n  getRef: RefCallback<HTMLTextAreaElement> = (element) => {\n    this.element = element;\n    setRef(element, this.props.getRef);\n  };\n\n  resize: VoidFunction = () => {\n    const el = this.element;\n\n    if (el) {\n      const { offsetHeight, scrollHeight } = el;\n      const style = window.getComputedStyle(el);\n      const paddingTop = parseInt(style.paddingTop);\n      const paddingBottom = parseInt(style.paddingBottom);\n\n      let diff = paddingTop + paddingBottom;\n\n      if (scrollHeight + diff <= offsetHeight) {\n        diff = 0;\n      }\n\n      if (el.value) {\n        this.setState({ height: scrollHeight - diff });\n      }\n\n      this.setState({ height: 0 }, () => {\n        const height = el.scrollHeight - diff;\n\n        this.setState({ height });\n\n        if (this.props.onResize) {\n          this.props.onResize(el);\n        }\n      });\n    }\n  };\n\n  get value() {return this.isControlledOutside ? this.props.value : this.state.value;}\n\n  onChange: ChangeEventHandler = (e: ChangeEvent<HTMLTextAreaElement>) => {\n    if (!this.isControlledOutside) {\n      this.setState({ value: e.target.value });\n    }\n\n    if (this.props.onChange) {\n      this.props.onChange(e);\n    }\n  };\n\n  componentDidUpdate(prevProps: TextareaProps, prevState: TextareaState) {\n    if (prevProps.value && this.props.value === '') {\n      // Fix iOS extra indent on removing content\n      window.requestAnimationFrame(() => {\n        this.element.value = '';\n      });\n    }\n\n    if (this.props.grow && (\n      this.isControlledOutside && prevProps.value !== this.props.value\n      || !this.isControlledOutside && prevState.value !== this.state.value\n    )) {\n      this.resize();\n    }\n  }\n\n  render() {\n    const { defaultValue, value, onChange, grow, style, onResize, className,\n      getRootRef, getRef, sizeY, platform, ...restProps } = this.props;\n\n    const height = this.state.height || style.height || 66;\n\n    return (\n      <FormField\n        vkuiClass={classNames(getClassName('Textarea', platform), `Textarea--sizeY-${sizeY}`)}\n        className={className}\n        style={style}\n        getRootRef={getRootRef}\n        disabled={restProps.disabled}\n      >\n        <textarea\n          {...restProps}\n          vkuiClass=\"Textarea__el\"\n          value={this.value}\n          onChange={this.onChange}\n          ref={this.getRef}\n          style={{ height }}\n        />\n      </FormField>\n    );\n  }\n}\nexport default withPlatform(withAdaptivity(Textarea, {\n  sizeY: true,\n}));\n"],"file":"Textarea.js"}