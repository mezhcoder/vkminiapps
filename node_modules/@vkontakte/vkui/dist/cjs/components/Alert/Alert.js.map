{"version":3,"sources":["../../../../src/components/Alert/Alert.tsx"],"names":["Alert","props","item","action","autoclose","setState","closing","waitTransitionFinish","e","propertyName","onClose","stopPropagation","i","platform","ANDROID","mode","onItemClick","title","VKCOM","element","React","createRef","state","eventHandler","transitionEvent","supported","current","removeEventListener","name","addEventListener","clearTimeout","transitionFinishTimeout","setTimeout","bind","header","IOS","text","actions","actionsLayout","children","className","style","viewWidth","restProps","resolvedActionsLayout","canShowCloseButton","ViewWidth","SMALL_TABLET","isDesktop","renderHeader","renderText","map","renderAction","Component"],"mappings":"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","sourcesContent":["import React, { Component, HTMLAttributes, MouseEventHandler, ReactNode, SyntheticEvent } from 'react';\nimport Tappable from '../Tappable/Tappable';\nimport PopoutWrapper from '../PopoutWrapper/PopoutWrapper';\nimport { getClassName } from '../../helpers/getClassName';\nimport { classNames } from '../../lib/classNames';\nimport { transitionEvent } from '../../lib/supportEvents';\nimport { ANDROID, VKCOM, IOS } from '../../lib/platform';\nimport { HasPlatform } from '../../types';\nimport { withPlatform } from '../../hoc/withPlatform';\nimport { withAdaptivity, AdaptivityProps, ViewWidth } from '../../hoc/withAdaptivity';\nimport Button from '../Button/Button';\nimport { hasReactNode } from '../../lib/utils';\nimport Headline from '../Typography/Headline/Headline';\nimport Title from '../Typography/Title/Title';\nimport Caption from '../Typography/Caption/Caption';\nimport ModalDismissButton from '../ModalDismissButton/ModalDismissButton';\n\nexport type AlertActionInterface = AlertProps['actions'][0];\n\nexport interface AlertProps extends HTMLAttributes<HTMLElement>, HasPlatform, AdaptivityProps {\n  actionsLayout?: 'vertical' | 'horizontal';\n  actions?: Array<{\n    title: string;\n    action?: VoidFunction;\n    autoclose?: boolean;\n    mode: 'cancel' | 'destructive' | 'default';\n  }>;\n  header?: ReactNode;\n  text?: ReactNode;\n  onClose?: VoidFunction;\n}\n\nexport interface AlertState {\n  closing: boolean;\n}\n\ntype TransitionEndHandler = (e?: TransitionEvent) => void;\n\ntype ItemClickHander = (item: AlertActionInterface) => () => void;\n\nclass Alert extends Component<AlertProps, AlertState> {\n  constructor(props: AlertProps) {\n    super(props);\n    this.element = React.createRef();\n    this.state = {\n      closing: false,\n    };\n  }\n\n  element: React.RefObject<HTMLDivElement>;\n\n  private transitionFinishTimeout: ReturnType<typeof setTimeout>;\n\n  static defaultProps: AlertProps = {\n    actionsLayout: 'horizontal',\n    actions: [],\n  };\n\n  onItemClick: ItemClickHander = (item: AlertActionInterface) => () => {\n    const { action, autoclose } = item;\n\n    if (autoclose) {\n      this.setState({ closing: true });\n      this.waitTransitionFinish((e?: TransitionEvent) => {\n        if (!e || e.propertyName === 'opacity') {\n          autoclose && this.props.onClose();\n          action && action();\n        }\n      });\n    } else {\n      action && action();\n    }\n  };\n\n  onClose: VoidFunction = () => {\n    this.setState({ closing: true });\n    this.waitTransitionFinish((e?: TransitionEvent) => {\n      if (!e || e.propertyName === 'opacity') {\n        this.props.onClose();\n      }\n    });\n  };\n\n  stopPropagation: MouseEventHandler = (e: SyntheticEvent) => {\n    e.stopPropagation();\n  };\n\n  waitTransitionFinish(eventHandler: TransitionEndHandler) {\n    if (transitionEvent.supported) {\n      this.element.current.removeEventListener(transitionEvent.name, eventHandler);\n      this.element.current.addEventListener(transitionEvent.name, eventHandler);\n    } else {\n      clearTimeout(this.transitionFinishTimeout);\n      this.transitionFinishTimeout = setTimeout(eventHandler.bind(this), this.props.platform === ANDROID || this.props.platform === VKCOM ? 200 : 300);\n    }\n  }\n\n  renderHeader(header: ReactNode) {\n    switch (this.props.platform) {\n      case VKCOM:\n        return <Headline vkuiClass=\"Alert__header\" weight=\"medium\">{header}</Headline>;\n      case IOS:\n        return <Title vkuiClass=\"Alert__header\" weight=\"semibold\" level=\"3\">{header}</Title>;\n      case ANDROID:\n        return <Title vkuiClass=\"Alert__header\" weight=\"medium\" level=\"2\">{header}</Title>;\n    }\n  }\n\n  renderText(text: ReactNode) {\n    switch (this.props.platform) {\n      case VKCOM:\n        return <Caption vkuiClass=\"Alert__text\" level=\"1\" weight=\"regular\">{text}</Caption>;\n      case IOS:\n        return <Caption vkuiClass=\"Alert__text\" level=\"2\" weight=\"regular\">{text}</Caption>;\n      case ANDROID:\n        return <Headline vkuiClass=\"Alert__text\" weight=\"regular\">{text}</Headline>;\n    }\n  }\n\n  renderAction = (action: AlertActionInterface, i: number) => {\n    const { platform } = this.props;\n    switch (platform) {\n      case ANDROID:\n        return (\n          <Button\n            vkuiClass={classNames('Alert__button', `Alert__button--${action.mode}`)}\n            mode=\"tertiary\"\n            size=\"m\"\n            onClick={this.onItemClick(action)}\n            key={`alert-action-${i}`}\n          >\n            {action.title}\n          </Button>\n        );\n      case VKCOM:\n        return (\n          <Button\n            vkuiClass={classNames('Alert__button', `Alert__button--${action.mode}`)}\n            size=\"m\"\n            mode={action.mode === 'cancel' ? 'secondary' : 'primary'}\n            onClick={this.onItemClick(action)}\n            key={`alert-action-${i}`}\n          >\n            {action.title}\n          </Button>\n        );\n      default:\n        return (\n          <Tappable\n            Component=\"button\"\n            vkuiClass={classNames('Alert__action', `Alert__action--${action.mode}`)}\n            onClick={this.onItemClick(action)}\n            key={`alert-action-${i}`}\n          >\n            {action.title}\n          </Tappable>\n        );\n    }\n  };\n\n  render() {\n    const { actions, actionsLayout, children, className, style, platform, viewWidth, text, header, ...restProps } = this.props;\n    const { closing } = this.state;\n\n    const resolvedActionsLayout: AlertProps['actionsLayout'] = platform === VKCOM ? 'horizontal' : actionsLayout;\n    const canShowCloseButton = platform === VKCOM || platform === ANDROID && viewWidth >= ViewWidth.SMALL_TABLET;\n    const isDesktop = viewWidth >= ViewWidth.SMALL_TABLET;\n\n    return (\n      <PopoutWrapper\n        className={className}\n        closing={closing}\n        style={style}\n        onClick={this.onClose}\n      >\n        <div\n          {...restProps}\n          ref={this.element}\n          onClick={this.stopPropagation}\n          vkuiClass={classNames(getClassName('Alert', platform), {\n            'Alert--v': resolvedActionsLayout === 'vertical',\n            'Alert--h': resolvedActionsLayout === 'horizontal',\n            'Alert--closing': closing,\n            'Alert--desktop': isDesktop,\n          })}\n        >\n          {canShowCloseButton && <ModalDismissButton onClick={this.onClose} />}\n          <div vkuiClass=\"Alert__content\">\n            {hasReactNode(header) && this.renderHeader(header)}\n            {hasReactNode(text) && this.renderText(text)}\n            {children}\n          </div>\n          <footer vkuiClass=\"Alert__actions\">\n            {actions.map(this.renderAction)}\n          </footer>\n        </div>\n      </PopoutWrapper>\n    );\n  }\n}\n\nexport default withPlatform(withAdaptivity(Alert, {\n  viewWidth: true,\n}));\n"],"file":"Alert.js"}